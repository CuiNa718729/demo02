<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="${ctx}/admin_comp/css/jquery.Jcrop.css">
<script type="text/javascript" src="${ctx}/admin_comp/jquery/jquery.Jcrop.js"></script>
<script type="text/javascript" src="${ctx}/admin_comp/jquery/picCut.js"></script>
<link rel="stylesheet" href="${ctx}/admin_comp/metro/summernote.css">
<script type="text/javascript" src="${ctx}/admin_comp/metro/summernote.min.js"></script>
<script type="text/javascript" src="${ctx}/admin_comp/metro/summernote-zh-CN.js"></script>
</head>

<body>
	<form id="addFlowerBoxForm" action="${ctx}/admin/iklar/addFlowerBox" method="post" role="form" class="form-horizontal">
		<div class="form-group">
                <div class="col-xs-2">
                    <label class="control-label" style="width:90px;text-align:right;height:34px;color: #797979;">名称：</label>
                </div>
                <div class="col-xs-7  errorAdd">
                	<span style="display:block;">
                    	<input class="form-control" name="flowerpotName" style="width:234px;border-color:#e2e2e4">
                    </span>
                </div>
         </div>
		<div class="form-group">
                    <div class="col-xs-2">
                        <label class="control-label" style="width:90px;height:34px;text-align:right;color: #797979;">花盆图片：</label>
                    </div>
                    <div class="col-xs-7 errorAdd" style="position:relative;overflow:hidden;">
                    	<div style="padding:0 8px;display:inline-block;overflow:hidden;height:34px;line-height:34px;width:234px;border:1px solid #e2e2e4;border-radius:4px;"></div>
                    	<!-- <span class="class" style="position:absolute;z-index:10;top:0;left:15px;display:inline-block;width:234px;height:34px;line-height:34px;padding:0 8px;border:1px solid #ddd;border-radius:4px;"></span> -->
	                    <a href="javascript:;" style="display:inline-block;left:0;width:70px;height:34px;background:#4b8df8;color:#fff;line-height: 34px;text-align:center;cursor: pointer;overflow:hidden;border-radius: 3px;text-decoration: none;overflow: hidden;position:relative;">上传文件
	                      <input type="file" name="flowerpotImg" id="flowerpotImg" style="opacity: 0;position:absolute;right: 0;top: 0;font-size:100px;cursor: pointer;" onchange="PreviewImage(this,'imgHeadPhoto1','divPreview1','flowerpotImg');" size="20">
	                    </a>
	                     <a class="img-delete" href="#" style="display:inline-block;width:60px;height:34px;background:#4b8df8;color:#fff;line-height: 34px;text-align:center;cursor: pointer;border-radius: 3px;text-decoration: none;position:absolute;right:30px;top: 0;">删除
	                     </a>
                    </div>
                    <div class="col-xs-3">
                     	<div id="divPreview1">
                     	<img id="imgHeadPhoto1" src="" style="width: 150px; height: 150px; padding:4px;border-radius:4px;border: solid 1px #d2e2e2;display:none;" alt="">
                     	</div>
                    </div>
                    
        </div>
		<div class="form-group">
                    <div class="col-xs-2">
                        <label class="control-label" style="width:90px;text-align:right;height:34px;color: #797979;">花盆大图：</label>
                    </div>
                    <div class="col-xs-7 errorAdd" style="position:relative;">
                    	<div style="padding:0 8px;display:inline-block;overflow:hidden;height:34px;line-height:34px;width:234px;border:1px solid #e2e2e4;border-radius:4px;"></div>
                    	<!-- <span style="position:absolute;z-index:10;top:0;left:15px;display:inline-block;width:234px;height:34px;line-height:34px;padding:0 8px;border:1px solid #ddd;border-radius:4px;"></span> -->
	                    <a href="javascript:;" style="display:inline-block;left:0;width:70px;height:34px;background:#4b8df8;color:#fff;line-height: 34px;text-align:center;cursor: pointer;border-radius: 3px;text-decoration: none;overflow: hidden;position:relative;">上传文件
	                      <input type="file" name="flowerpotImgBig" id="flowerpotImgBig" style="opacity: 0;position:absolute;right: 0;top: 0;font-size:100px;cursor: pointer;" onchange="PreviewImage(this,'imgHeadPhoto2','divPreview2','flowerpotImgBig');" size="20">
	                    </a>
	                     <a class="img-delete" href="#" style="display:inline-block;width:60px;height:34px;background:#4b8df8;color:#fff;line-height: 34px;text-align:center;cursor:pointer;border-radius: 3px;text-decoration: none;position:absolute;right:30px;top: 0;">删除
	                     </a>
                    </div>
                    <div class="col-xs-3">
                     	<div id="divPreview2">
                     	<img id="imgHeadPhoto2" src="" style="width: 150px; height: 150px; padding:4px;border-radius:4px;border: solid 1px #d2e2e2;display:none;" alt="">
                     	</div>
                    </div>
                    
        </div>
		<div class="popWindow-button">
			<button type="button" 
							onclick="addInstaller(this);" 
							 class="btn green ladda-button" data-spinner-color="#555" data-style="zoom-in">
					<i class="icon-download-alt"></i>
					<span class="ladda-label">保存</span>
			</button>
			<button type="button" onclick="closeTopmostWindow();" class="btn btn-default btn-sm">
			<i class="icon-remove-sign"></i>
			<span>取消</span>
			</button>
		</div>
		
	</form>
	<script type="text/javascript">
	function validateForm() {     
		return $("#addFlowerBoxForm").validate({     
			errorPlacement: function(error, element) {
					$( element ).parents(".errorAdd").append(error);
			},
			rules: {     
				flowerpotName: "required",
				flowerpotImg: "required",
				flowerpotImgBig:"required"
			},     
			messages:{   
				flowerpotName: "请填写名称",
				flowerpotImg: "请上传花盆图片",
				flowerpotImgBig:"请上传花盆大图"
			}
		}).form();     
	}     
	function addInstaller(addBtn){     
		if(validateForm()){     
			var ladda=Ladda.create(addBtn);
			ladda.start();
			$("#addFlowerBoxForm").ajaxSubmit({
				success:function(data){ 
					switch (data.msg){
						case "success":
							bootbox.alert({
			        			size:'small',
			        			message:'添加成功！'
			        		});
			        		ladda.stop();
			        		var btn = $("#installer #searchInstallerBtn");
			        		ajaxSubmitFormButton("installer #search_from","installer #content_div",btn[0]);
			        		closeTopmostWindow();
			        		break;
						default:
							bootbox.alert("添加失败！");
		        			ladda.stop();
					}
				}     
			});
	    }    
	}    
	cancelUser = function(){
		closeTopmostWindow();
	};


    //js本地图片预览，兼容ie[6-9]、火狐、Chrome17+、Opera11+、Maxthon3
    function PreviewImage(fileObj, imgPreviewId, divPreviewId,inputId) {
        var allowExtention = ".jpg,.bmp,.gif,.png"; //允许上传文件的后缀名document.getElementById("hfAllowPicSuffix").value;
        var extention = fileObj.value.substring(fileObj.value.lastIndexOf(".") + 1).toLowerCase();
        var browserVersion = window.navigator.userAgent.toUpperCase();
        if (allowExtention.indexOf(extention) > -1) { 
        	var imgName=$("#"+inputId).val();
        	var  i=imgName.lastIndexOf("\\");
        	imgName=imgName.slice(i+1);
        	$("#"+inputId).parent().prev().html(imgName);
            if (fileObj.files) {//HTML5实现预览，兼容chrome、火狐7+等
                if (window.FileReader) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                    	document.getElementById(imgPreviewId).style.display="block";
                        document.getElementById(imgPreviewId).setAttribute("src", e.target.result); 
                    }
                    reader.readAsDataURL(fileObj.files[0]);
                } else if (browserVersion.indexOf("SAFARI") > -1) {
                    alert("不支持Safari6.0以下浏览器的图片预览!");
                }
            } else if (browserVersion.indexOf("MSIE") > -1) {
                if (browserVersion.indexOf("MSIE 6") > -1) {//ie6
                    document.getElementById(imgPreviewId).setAttribute("src", fileObj.value);
                } else {//ie[7-9]
                    fileObj.select();
                    if (browserVersion.indexOf("MSIE 9") > -1)
                        fileObj.blur(); //不加上document.selection.createRange().text在ie9会拒绝访问
                    var newPreview = document.getElementById(divPreviewId + "New");
                    if (newPreview == null) {
                        newPreview = document.createElement("div");
                        newPreview.setAttribute("id", divPreviewId + "New");
                        newPreview.style.width = document.getElementById(imgPreviewId).width + "px";
                        newPreview.style.height = document.getElementById(imgPreviewId).height + "px";
                        newPreview.style.border = "solid 1px #d2e2e2";
                    }
                    newPreview.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='" + document.selection.createRange().text + "')";
                    var tempDivPreview = document.getElementById(divPreviewId);
                    tempDivPreview.parentNode.insertBefore(newPreview, tempDivPreview);
                    tempDivPreview.style.display = "none";
                }
            } else if (browserVersion.indexOf("FIREFOX") > -1) {//firefox
                var firefoxVersion = parseFloat(browserVersion.toLowerCase().match(/firefox\/([\d.]+)/)[1]);
                if (firefoxVersion < 7) {//firefox7以下版本
                    document.getElementById(imgPreviewId).setAttribute("src", fileObj.files[0].getAsDataURL());
                } else {//firefox7.0+                    
                    document.getElementById(imgPreviewId).setAttribute("src", window.URL.createObjectURL(fileObj.files[0]));
                }
            } else {
                document.getElementById(imgPreviewId).setAttribute("src", fileObj.value);
            }
        } else {
            alert("仅支持" + allowExtention + "为后缀名的文件!");
            fileObj.value = ""; //清空选中文件
            if (browserVersion.indexOf("MSIE") > -1) {
                fileObj.select();
                document.selection.clear();
            }
            fileObj.outerHTML = fileObj.outerHTML;
        }
        return fileObj.value;    //返回路径
    }

	$(".img-delete").click(function(e){
		e.preventDefault();
		if($(this).prev().children().val()){
			$(this).prev().children().val("");
			$(this).parent().next().find("img").css({"src":"","display":"none"});
			$(this).prev().prev().html("");
		}
		return;
	}); 
	</script>
</body>
</html>
	